# Nomogram Calculator App

🏥 **医生临床决策助手** - 基于Cox回归模型的患者生存率预测计算器

## 📱 功能特点

- ✅ **移动端优化**: 专为手机设计，响应式界面
- ✅ **离线可用**: PWA技术支持，可离线计算
- ✅ **实时计算**: 输入数据后立即获得生存率预测
- ✅ **多时间点**: 提供2年、5年、8年生存率预测
- ✅ **输入验证**: 智能验证输入数据的有效性
- ✅ **结果可视化**: 直观的百分比显示和风险评估
- ✅ **CSV导出**: 支持导出当前记录和所有历史记录到CSV文件
- ✅ **历史记录**: 自动保存每次计算记录，支持批量导出
- ✅ **完全离线**: 所有数据存储在本地，不上传服务器

## 🚀 快速开始

### 在线使用
1. 在手机浏览器中打开应用
2. 输入患者的临床数据
3. 点击"计算生存率"按钮
4. 查看预测结果

### 本地部署
```bash
# 克隆或下载项目
cd nomogram-app

# 使用任何HTTP服务器启动
python3 -m http.server 8000
# 或使用Node.js
npx serve .

# 在浏览器中访问
open http://localhost:8000
```

## 📋 输入参数说明

| 参数 | 说明 | 正常范围 | 单位 |
|------|------|----------|------|
| 年龄 (Age) | 患者年龄 | 0-120 | 岁 |
| 性别 (Sex) | 患者性别 | 男性/女性 | - |
| 胆红素 (Bilirubin) | 血清胆红素水平 | 0-50 | mg/dL |
| 铜 (Copper) | 血清铜水平 | 0-1000 | μg/dL |
| 疾病分期 (Stage) | 临床疾病分期 | 1-4期 | - |
| 治疗方案 (Treatment) | 使用的治疗方案 | 对照组/治疗1/治疗2 | - |

## 📊 输出结果

- **2年生存率**: 2年后的预期生存概率
- **5年生存率**: 5年后的预期生存率
- **8年生存率**: 8年后的预期生存率

### 结果解释
- 🟢 **高概率** (>80%): 预后良好
- 🟡 **中等概率** (50-80%): 需要定期随访
- 🔴 **低概率** (<50%): 建议积极治疗

## 💾 CSV导出功能

### 使用方法
1. **自动保存**: 每次计算后，记录自动保存到本地存储
2. **导出当前记录**: 点击"💾 导出当前记录"按钮，下载当前患者的CSV文件
3. **导出所有记录**: 点击"📥 导出所有历史记录"按钮，批量导出所有保存的记录
4. **清空历史**: 点击"🗑️ 清空历史"按钮，删除所有本地保存的记录

### CSV文件格式
导出的CSV文件包含以下字段：
- 记录时间
- 年龄、性别、胆红素、铜、疾病分期、治疗方案（输入参数）
- 2年/5年/8年生存率（预测结果）
- 风险评分、线性预测值（模型参数）

### 数据安全
- ✅ 所有数据保存在手机浏览器的本地存储（localStorage）
- ✅ 不会上传到任何服务器
- ✅ 数据完全由您控制，可随时清空
- ✅ 导出的CSV文件保存在手机下载文件夹
- ✅ 支持Excel直接打开，中文显示正常

### 数据持久化

#### 数据会保留吗？
✅ **应用关闭后数据不会丢失**。所有历史记录使用浏览器localStorage技术保存，具有以下特点：

- ✅ 关闭应用/浏览器后数据保留
- ✅ 手机重启后数据保留
- ✅ 长期保存（除非手动清除）
- ✅ 可存储10,000-20,000条记录

#### 数据会丢失的情况
- ❌ 清除浏览器数据/缓存
- ❌ 卸载PWA应用
- ❌ 使用隐私/无痕浏览模式
- ❌ 点击"清空历史"按钮

#### 数据备份建议
1. **定期导出备份**：定期点击"导出所有历史记录"保存CSV文件
2. **重要数据立即导出**：录入重要患者数据后立即导出
3. **云端备份**：将导出的CSV文件保存到iCloud/Google Drive

**注意**：不同浏览器（Safari/Chrome）和不同设备的数据是独立的，建议通过CSV导出文件在设备间共享数据。

## 🔬 技术原理

### 模型基础
基于FigureYa30nomogram_update模块的Cox比例风险模型:

```
h(t) = h₀(t) × exp(β₁×age + β₂×bili + β₃×sex + β₄×copper + β₅×stage + β₆×trt)
```

### 模型系数
- age: 0.032175
- catbili_medium: 1.408395
- catbili_high: 1.811699
- sex_male: -0.258128
- copper: 0.003118
- stage: 0.543079
- trt: 0.110627

### 胆红素分类
- 低风险 (Low): ≤ 2 mg/dL
- 中风险 (Medium): 2-4 mg/dL
- 高风险 (High): > 4 mg/dL

## 🛠️ 技术栈

- **前端**: HTML5, CSS3, JavaScript (ES6+)
- **PWA**: Service Worker, Web App Manifest
- **样式**: Responsive Design, Mobile-first
- **计算**: Cox回归算法实现
- **缓存**: Cache API, Background Sync

## 📱 PWA功能

- **离线支持**: 可在没有网络连接的情况下使用
- **安装到主屏幕**: 可添加到手机主屏幕
- **后台更新**: 自动缓存更新最新版本
- **快速启动**: 优化的加载速度

## ⚠️ 使用须知

1. **仅供参考**: 计算结果仅供临床参考，不能替代专业医疗判断
2. **数据质量**: 输入数据的准确性影响结果可靠性
3. **模型限制**: 基于特定数据集训练，可能不适用于所有人群
4. **定期更新**: 模型参数会定期更新，请使用最新版本

## 🔒 隐私保护

- ✅ **本地计算**: 所有计算均在设备本地进行
- ✅ **无数据上传**: 不会上传患者数据到服务器
- ✅ **无跟踪**: 不包含任何用户跟踪代码
- ✅ **离线使用**: 完全可以离线使用

## 📞 技术支持

如有问题或建议，请联系：
- 基于FigureYa项目开发
- 参考: FigureYa: A Standardized Visualization Framework for Enhancing Biomedical Data Interpretation and Research Efficiency

## 📄 许可证

本项目基于Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License

---

**免责声明**: 本应用仅供学术研究和临床参考使用，使用本应用进行临床决策的风险由使用者自行承担。