FigureYa244PCAPlot
Code
Show All Code
Hide All Code
FigureYa244PCAPlot
Author(s)
: Jianing Gao
Reviewer(s)
: Ying Ge, Hui Huang
Date
: 2025-11-30
1
Academic Citation
If you use this code in your work or research, we kindly request that
you cite our publication:
Xiaofan Lu, et al. (2025). FigureYa: A Standardized Visualization
Framework for Enhancing Biomedical Data Interpretation and Research
Efficiency. iMetaMed.
https://doi.org/10.1002/imm3.70005
2
需求描述 Requirement
Description
基因聚类，然后在图上标注出来。不用说要跟原文一个数据吧，只要输入数据得出类似的图就行。
Genes are clustered and then annotated on the graph. Needless to say,
you need to have the same data as the original text, as long as you
enter the data to get a similar graph.
From
https://www.sciencedirect.com/science/article/pii/S2352396421003340?via%3Dihub
Fig. 1. Prognostic stratification of PDAC through their GT gene
expression profile (a, b) and clinical features of patients with their
PDAC molecular profiles (c, d). (a) Biplot of the HCPC analysis result
based on RNA-seq data of 74 PDAC and 169 GT genes.
3
应用场景 Application
Scenarios
先聚类，再用 PCA 可视化聚类结果。聚类算法（如
k-means）在高维空间中计算距离，人类无法直观理解。借用 PCA
将高维空间投影到 2D，让我们看到聚类的空间分布。
用多边形框出每个聚类的边界，视觉上更清晰地展示聚类效果。
如果聚类是合理的，在 PCA 图上应该能看到明显分离；
如果 PCA 图上混在一起，说明聚类可能过度拟合；
用geom_text_repel标注样本名，便于追溯哪个样本不靠谱。
PCA 可以画个小圈圈展示理论分布（置信区间），可参考FigureYa38PCA。
也可以像FigureYa244PCAPlot这样画多边形展示实际分布。灵活运用这样的图来展示正常
PCA/UMAP 结果也完全没问题，直接跳到方法二: ggplot，即可套用。
First cluster, and then use PCA to visualize the clustering results.
Clustering algorithms (such as k-means) calculate distances in
high-dimensional space, which humans cannot intuitively understand.
Using PCA to project high-dimensional space to 2D allows us to see the
spatial distribution of clusters.
Use polygons to outline the boundaries of each cluster, providing a
clearer visual representation of the clustering effect.
If clustering is reasonable, you should see clear separation on the
PCA plot;
If samples are mixed together on the PCA plot, it suggests that
clustering may be overfitted;
Use geom_text_repel to label sample names for tracing unreliable
samples.
PCA can draw small circles to show theoretical distributions
(confidence intervals), refer to FigureYa38PCA.
Alternatively, you can draw polygons like FigureYa244PCAPlot to show
actual distributions. This approach can be flexibly applied to display
normal PCA/UMAP results as well, simply skip to Method 2: ggplot and
apply the template.
4
环境设置 Environment
settings
source
(
"install_dependencies.R"
)
source
(
"geom_convexhull.R"
)
# from ggConvexHull package
library
(tidyverse)
# Data manipulation
library
(factoextra)
# PCA visualization
Sys.setenv
(
LANGUAGE =
"en"
)
#显示英文报错信息 # error messages are displayed in English
options
(
stringsAsFactors =
FALSE
)
#禁止chr转成factor # chr is not allowed to be converted to factor
5
输入文件 Input
files
easy_input.csv，表达矩阵，每行一个基因，每列一个sample。
easy_input.csv, the expression matrix, one gene per row, one sample
per column.
data2
<-
read.csv
(
"easy_input.csv"
,
header =
T,
row.names =
1
)
data2[
1
:
2
,]
6
开始画图 Start
drawing
6.1
方法一:
调用factoextra包 Method 1: Call the factoextra package
p
<-
fviz_pca_ind
(
X =
pca,
repel =
T,
geom =
c
(
"point"
,
"text"
),
# 如果不想要文字标记,去掉text即可 # If you don't want the text tag, just remove the text
habillage =
k2
$
cluster,
# 添加分组信息 # Add group information
legend.title =
"cluster"
,
# 图例标题 # Legend title
mean.point =
FALSE
,
# 是否添加聚类中心 # Whether to add a cluster center
palette =
c
(
"red"
,
"blue"
),
# change color, map to col.ind
pointsize =
2.5
,
# 点的大小 # The size of the dot
addEllipses =
TRUE
,
# 添加外边框 # Add an outer border
ellipse.type =
"convex"
,
# 外边框类型, 凸多边形"convex" # Outer Border Type, Convex Polygon "Convex"
axes.linetype =
"blank"
,
# hide zerolines
ggtheme =
theme_classic
(
base_size =
15
)
# ggplot主题 # ggplot theme
)
# remove text legend
p
<-
p
+
guides
(
color =
guide_legend
(
override.aes =
aes
(
label =
""
)))
# theme
p
+
theme
(
legend.position =
"top"
,
plot.title =
element_blank
(),
axis.text =
element_text
(
color =
"black"
)
)
ggsave
(
"PCA_factoextra.pdf"
)
6.2
方法二: ggplot Method
2: ggplot
data.use
<-
as.data.frame
(pca
$
x[,
c
(
"PC1"
,
"PC2"
)])
data.use
$
cluster
<-
factor
(k2
$
cluster)
data.use
$
name
<-
rownames
(data.use)
vars.percent
<-
pca
$
sdev
^
2
/
sum
(pca
$
sdev
^
2
)
# 计算不同主成分解释的数据方差 # Calculate the variance of the data for different principal component explanations
dims
<-
c
(
1
,
2
)
# 选择PC1和PC2进行可视化 # Select PC1 and PC2 for visualization
xlab
<-
paste0
(
"Dim1 ("
,
round
(vars.percent[dims[
1
]]
*
100
,
1
),
"%)"
)
ylab
<-
paste0
(
"Dim2 ("
,
round
(vars.percent[dims[
2
]]
*
100
,
1
),
"%)"
)
colors.use
<-
c
(
"red"
,
"blue"
)
data.use[
1
:
2
,]
画图 Drawing
ggplot
(data.use,
aes
(PC1, PC2,
shape=
cluster,
color=
cluster))
+
geom_point
(
size =
2.5
)
+
geom_convexhull
(
aes
(
fill=
cluster),
alpha =
0.15
)
+
ggrepel
::
geom_text_repel
(
aes
(
label=
name),
size =
3
,
max.iter =
2000
,
# 如果样本太多，text overlap无法解决，可以增大max.iter参数 # If there are too many samples and the text overlap cannot be solved, you can increase the max.iter parameter
show.legend =
F)
+
scale_color_manual
(
values =
colors.use)
+
scale_fill_manual
(
values =
colors.use)
+
labs
(
x =
xlab,
y =
ylab)
+
theme_classic
(
base_size =
15
)
+
theme
(
legend.position =
"top"
,
plot.title =
element_blank
(),
axis.text =
element_text
(
color =
"black"
)
)
ggsave
(
"PCA_ggplot2.pdf"
)
7
Session Info
sessionInfo
()